# –î–≤—É—Ö—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è amoCRM –∏ Google Sheets

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –≤–∞—à–µ–π Google –¢–∞–±–ª–∏—Ü–µ–π –∏ —Å–¥–µ–ª–∫–∞–º–∏ –≤ amoCRM –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.

## üîÆ –ß—Ç–æ –æ–Ω —É–º–µ–µ—Ç?

1.  **–°–æ–∑–¥–∞–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏:** –ö–æ–≥–¥–∞ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ Google –¢–∞–±–ª–∏—Ü—É, –≤ amoCRM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–¥–µ–ª–∫–∞.
2.  **–û–±–Ω–æ–≤–ª—è—Ç—å —Å–¥–µ–ª–∫–∏:** –ö–æ–≥–¥–∞ –≤—ã –º–µ–Ω—è–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫–µ —Ç–∞–±–ª–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—É–º–º—É), —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å–¥–µ–ª–∫–µ –≤ amoCRM.
3.  **–û–±–Ω–æ–≤–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü—É:** –ö–æ–≥–¥–∞ –≤—ã –º–µ–Ω—è–µ—Ç–µ —Å–¥–µ–ª–∫—É –≤ amoCRM (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥–≤–∏–≥–∞–µ—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–π —ç—Ç–∞–ø –∏–ª–∏ –º–µ–Ω—è–µ—Ç–µ –±—é–¥–∂–µ—Ç), —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ —Ç–∞–±–ª–∏—Ü—ã.

## üöÄ –ü–æ—à–∞–≥–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å –Ω—É–ª—è

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ —ç—Ç–æ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑.

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ "–∫–ª—é—á–µ–π" –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤

–ß—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–≥–ª–∏ "–æ–±—â–∞—Ç—å—Å—è" –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º, –∏–º –Ω—É–∂–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–ª—é—á–∞–º–∏ –∏–ª–∏ —Ç–æ–∫–µ–Ω–∞–º–∏.

#### üîë –ö–ª—é—á –æ—Ç Google

1.  **–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç** –≤ Google Cloud –∏ —Å–∫–∞—á–∞–π—Ç–µ **JSON-—Ñ–∞–π–ª** —Å –∫–ª—é—á–æ–º. (–ü–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É "google cloud create service account json key").
2.  **–í–∫–ª—é—á–∏—Ç–µ –¥–≤–∞ API** –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ Google Cloud:
    - **Google Sheets API**
    - **Google Drive API**

#### üîë –ö–ª—é—á –æ—Ç amoCRM

1.  –ó–∞–π–¥–∏—Ç–µ –≤ –≤–∞—à amoCRM.
2.  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `–ù–∞—Å—Ç—Ä–æ–π–∫–∏` -> `–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏` –∏ –Ω–∞–∂–º–∏—Ç–µ `–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é` -> `–í–Ω–µ—à–Ω—è—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è`.
3.  –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –≤ "–°—Å—ã–ª–∫—É –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è" –≤—Å—Ç–∞–≤—å—Ç–µ `https://example.com`, –¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø—ã –∫ —Å–¥–µ–ª–∫–∞–º. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ.
4.  –ù–∞ –≤–∫–ª–∞–¥–∫–µ **"–ö–ª—é—á–∏ –∏ –¥–æ—Å—Ç—É–ø—ã"** —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ **"–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π —Ç–æ–∫–µ–Ω"**.
5.  –¢–∞–∫–∂–µ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤–∞—à **—Å—É–±–¥–æ–º–µ–Ω** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `mycompany` –∏–∑ `mycompany.amocrm.ru`).

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –≤—Å–µ "–∫–ª—é—á–∏", –Ω–∞—Å—Ç—Ä–æ–∏–º —Å–∞–º –ø—Ä–æ–µ–∫—Ç.

1.  **–ü–æ–ª–æ–∂–∏—Ç–µ JSON-–∫–ª—é—á** –æ—Ç Google –≤ –ø–∞–ø–∫—É `credentials`.
2.  **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ø–∏—é** —Ñ–∞–π–ª–∞ `.env.example` –∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –µ–µ –≤ `.env`.
3.  **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env`** –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

    ```dotenv
    # –ü—É—Ç—å –∫ –≤–∞—à–µ–º—É JSON-–∫–ª—é—á—É. –ï—Å–ª–∏ –≤—ã –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–ª–∏, –æ–Ω —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.
    GOOGLE_APPLICATION_CREDENTIALS="credentials/–í–ê–®_–§–ê–ô–õ.json"

    # ID –≤–∞—à–µ–π Google –¢–∞–±–ª–∏—Ü—ã. –ï–≥–æ –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É.
    # https://docs.google.com/spreadsheets/d/–í–û–¢_–≠–¢–û–¢_–î–õ–ò–ù–ù–´–ô_ID/edit
    GOOGLE_SHEET_NAME="–í–ê–®_ID_–¢–ê–ë–õ–ò–¶–´"

    # –¢–æ—Ç —Å–∞–º—ã–π –¥–ª–∏–Ω–Ω—ã–π –∫–ª—é—á –∏–∑ amoCRM.
    AMOCRM_INTEGRATION_TOKEN="–í–ê–®_–î–û–õ–ì–û–°–†–û–ß–ù–´–ô_–¢–û–ö–ï–ù"

    # –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å –∞–¥—Ä–µ—Å–∞ –≤–∞—à–µ–≥–æ amoCRM.
    AMOCRM_SUBDOMAIN="–í–ê–®_–°–£–ë–î–û–ú–ï–ù"
    ```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ID –≤ –∫–æ–¥–µ

–ü—Ä–æ–≥—Ä–∞–º–º–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ç–æ—á–Ω—ã–µ ID –≤–∞—à–∏—Ö –≤–æ—Ä–æ–Ω–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ amoCRM.

1.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `app/sync_sheets_to_amo.py`.
2.  –ù–∞–π–¥–∏—Ç–µ –∏ –∑–∞–º–µ–Ω–∏—Ç–µ ID –≤ —ç—Ç–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö:
    ```python
    PIPELINE_ID = 12345  # ID –≤–∞—à–µ–π –≤–æ—Ä–æ–Ω–∫–∏
    STATUS_ID = 67890    # ID —Å—Ç–∞—Ç—É—Å–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ø–∞–¥–µ—Ç –Ω–æ–≤–∞—è —Å–¥–µ–ª–∫–∞
    ```
    - **–ö–∞–∫ —É–∑–Ω–∞—Ç—å ID?** –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî —á–µ—Ä–µ–∑ API-–∑–∞–ø—Ä–æ—Å `curl`, –∫–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏ —Ä–∞–Ω–µ–µ (–∑–∞–ø—Ä–æ—Å –∫ `/api/v4/leads/pipelines`).

### –®–∞–≥ 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Google –¢–∞–±–ª–∏—Ü—ã

1.  **–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–ª–æ–Ω–∫–∏.** –í –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–∏–º–µ–Ω–Ω–æ —Å —Ç–∞–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏):
    `lead_id` | `–ò–º—è` | `–¢–µ–ª–µ—Ñ–æ–Ω` | `Email` | `–°—É–º–º–∞` | `–°—Ç–∞—Ç—É—Å` | `–í–æ—Ä–æ–Ω–∫–∞`
    - –ö–æ–ª–æ–Ω–∫—É `lead_id` –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç–æ–π, —Å–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç –µ–µ —Å–∞–º.
2.  **–î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø —Ä–æ–±–æ—Ç—É.**
    - –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à JSON-–∫–ª—é—á, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ—Ç—Ç—É–¥–∞ `client_email`.
    - –í Google –¢–∞–±–ª–∏—Ü–µ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞", –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç email –∏ –¥–∞–π—Ç–µ –µ–º—É –ø—Ä–∞–≤–∞ **"–†–µ–¥–∞–∫—Ç–æ—Ä–∞"**.

### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫!

1.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª (–∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É) –≤ –ø–∞–ø–∫–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º.
2.  **–°–æ–∑–¥–∞–µ–º "–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ"** (–ª–∏—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞):
    ```bash
    python -m venv .venv
    ```
3.  **–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ–≥–æ:**
    - –ù–∞ Windows: `.\.venv\Scripts\activate`
    - –ù–∞ macOS/Linux: `source .venv/bin/activate`
4.  **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
    ```bash
    pip install .
    ```
5.  **–ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä:**
    ```bash
    uvicorn main:app --reload
    ```
    –ï—Å–ª–∏ –≤—Å–µ —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ amoCRM —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç.

### –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (amoCRM -> –¢–∞–±–ª–∏—Ü–∞)

–ß—Ç–æ–±—ã amoCRM –º–æ–≥ "–¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è" –¥–æ –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º `ngrok`.

1.  –°–∫–∞—á–∞–π—Ç–µ `ngrok` —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π:
    ```bash
    ngrok http 8000
    ```
2.  `ngrok` –ø–æ–∫–∞–∂–µ—Ç –≤–∞–º –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å –≤–∏–¥–∞ `https://—Å–ª—É—á–∞–π–Ω—ã–µ_–±—É–∫–≤—ã.ngrok.io`. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ.
3.  –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ amoCRM. –í –ø–æ–ª–µ **"–°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤"** –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å –æ—Ç ngrok –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ü–µ `/webhook/amocrm`. –î–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è:
    `https://—Å–ª—É—á–∞–π–Ω—ã–µ_–±—É–∫–≤—ã.ngrok.io/webhook/amocrm`
4.  –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏ **–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ** –µ–µ.

–¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏—Ç–µ —Å–¥–µ–ª–∫—É –≤ amoCRM, –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `uvicorn`, –ª–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–∞, –∏ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–∞–Ω–Ω—ã–µ –≤ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ –æ–±–Ω–æ–≤—è—Ç—Å—è.
